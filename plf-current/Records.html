<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Records: 为 STLC 添加记录体</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/plf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://coq-zh.github.io/SF-zh/'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 2: 编程语言基础</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>目录</a></li>
   <li class='section_name'><a href='coqindex.html'>索引</a></li>
   <li class='section_name'><a href='deps.html'>路线</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Records<span class="subtitle">为 STLC 添加记录体</span></h1>

<div class="code">
</div>

<div class="code">

<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Warnings</span> "-notation-overridden,-parsing".<br/>
<span class="id" title="var">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#"><span class="id" title="library">Strings.String</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Maps</span>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="library">Imp</span>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Smallstep.html#"><span class="id" title="library">Smallstep</span></a>.<br/>
<span class="id" title="var">From</span> <span class="id" title="var">PLF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Stlc.html#"><span class="id" title="library">Stlc</span></a>.<br/>
</div>

<div class="doc">
<a name="lab348"></a><h1 class="section">添加记录体</h1>

<div class="paragraph"> </div>

 在 <a href="MoreStlc.html"><span class="inlineref">MoreStlc</span></a> 一章中，我们了解到记录体（Record）
    可被视作嵌套使用的积类型的语法糖。对于简单的例子来说这样还行，
    然而其编码是非形式化的（实际上，如果我们真的以这种方式来对待记录体，
    那么它应该在解析器中处理，我们这里暂不考虑），总之它不太高效。
    因此了解如何将记录体作为语言中的一等公民仍然十分有趣。本章中展示了这种方法。

<div class="paragraph"> </div>

    请回忆我们之前给出的非形式化定义： 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

    语法：
<pre>
       t <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                          项：
           | {i<sub>1</sub>=t<sub>1</sub>, ..., in=tn}         记录
           | t.i                         投影
           | ...

       v <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                          值：
           | {i<sub>1</sub>=v<sub>1</sub>, ..., in=vn}         记录值
           | ...

       T <span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>:</span>:</span>=</span>                          类型：
           | {i<sub>1</sub>:T<sub>1</sub>, ..., in:Tn}         记录类型
           | ...
</pre>
   归约：
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">ti ==> ti'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Rcd) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{i<sub>1</sub>=v<sub>1</sub>, ..., im=vm, in=tn, ...} ==> {i<sub>1</sub>=v<sub>1</sub>, ..., im=vm, in=tn', ...}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub> ==> t<sub>1</sub>'</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_Proj1) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">t<sub>1</sub>.i ==> t<sub>1</sub>'.i</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (ST_ProjRcd) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">{..., i=vi, ...}.i ==> vi</td>
  <td></td>
</td>
</table></center>   定型：
<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t<sub>1</sub> : T<sub>1</sub>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gamma &#x22A2; tn : Tn</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Rcd) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; {i<sub>1</sub>=t<sub>1</sub>, ..., in=tn} : {i<sub>1</sub>:T<sub>1</sub>, ..., in:Tn}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t : {..., i:Ti, ...}</td>
  <td class="infrulenamecol" rowspan="3">
    (T_Proj) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule">Gamma &#x22A2; t.i : Ti</td>
  <td></td>
</td>
</table></center>
</div>

<div class="doc">
<a name="lab349"></a><h1 class="section">形式化记录体</h1>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <a name="STLCExtendedRecords"><span class="id" title="module">STLCExtendedRecords</span></a>.<br/>
</div>

<div class="doc">
<a name="lab350"></a><h3 class="section">语法和操作语义</h3>

<div class="paragraph"> </div>

 要将记录体的语法形式化，最显然的方式是这样的： 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Module</span> <a name="STLCExtendedRecords.FirstTry"><span class="id" title="module">FirstTry</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a name="STLCExtendedRecords.FirstTry.alist"><span class="id" title="definition">alist</span></a> (<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>) := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#list"><span class="id" title="inductive">list</span></a> (<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#d19c7eafd0e2d195d10df94b392087b<sub>5</sub>"><span class="id" title="notation">×</span></a> <a class="idref" href="Records.html#X"><span class="id" title="variable">X</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.FirstTry.ty"><span class="id" title="inductive">ty</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.FirstTry.Base"><span class="id" title="constructor">Base</span></a>     : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.FirstTry.Arrow"><span class="id" title="constructor">Arrow</span></a>    : <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.FirstTry.TRcd"><span class="id" title="constructor">TRcd</span></a>      : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.FirstTry.alist"><span class="id" title="definition">alist</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a>.<br/>
</div>

<div class="doc">
然而，我们在这里遇到了 Coq 的限制：该类型无法自动给出我们期望的归纳法则，
    也就是说，<span class="inlinecode"><span class="id" title="var">TRcd</span></span> 的情况中的归纳假设并未给出关于列表中的 <span class="inlinecode"><span class="id" title="var">ty</span></span> 元素的任何信息，
    因此它对我们想要做的证明毫无用处。 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;Check&nbsp;ty_ind.<br/>
&nbsp;&nbsp;&nbsp;====&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;ty_ind&nbsp;:<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;P&nbsp;:&nbsp;ty&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;Prop,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;i&nbsp;:&nbsp;id,&nbsp;P&nbsp;(Base&nbsp;i))&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;t&nbsp;:&nbsp;ty,&nbsp;P&nbsp;t&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;forall&nbsp;t<sub>0</sub>&nbsp;:&nbsp;ty,&nbsp;P&nbsp;t<sub>0</sub><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;P&nbsp;(Arrow&nbsp;t&nbsp;t<sub>0</sub>))&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(forall&nbsp;a&nbsp;:&nbsp;alist&nbsp;ty,&nbsp;P&nbsp;(TRcd&nbsp;a))&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;???&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;forall&nbsp;t&nbsp;:&nbsp;ty,&nbsp;P&nbsp;t<br/>
*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <a class="idref" href="Records.html#STLCExtendedRecords.FirstTry"><span class="id" title="module">FirstTry</span></a>.<br/>
</div>

<div class="doc">
让 Coq 为我们生成更好的归纳法则是可能的，但是实现它的具体细节并不是很漂亮，
    我们得到的法则也不如 Coq 为简单的 <span class="inlinecode"><span class="id" title="keyword">Inductive</span></span> 定义生成的法则那么直观易用。

<div class="paragraph"> </div>

    幸好，我们还能用另一种方式来形式化记录体，某种意义上说，它甚至更加简单和自然：
    我们并不使用 Coq 的标准 <span class="inlinecode"><span class="id" title="var">list</span></span> 类型，而是在类型的语法中直接包含它的构造子
    （“nil”和“cons”）。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.Base"><span class="id" title="constructor">Base</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> : <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a> : <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#ty"><span class="id" title="inductive">ty</span></a>.<br/>
</div>

<div class="doc">
与此类似，在“项”这一层上，我们有空记录体构造子 <span class="inlinecode"><span class="id" title="var">trnil</span></span>，
    以及将单个字段添加到字段列表之首的构造子 <span class="inlinecode"><span class="id" title="var">rcons</span></span>。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> : <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;记录体&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> : <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a> :  <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#tm"><span class="id" title="inductive">tm</span></a>.<br/>
</div>

<div class="doc">
一些例子…… 
</div>
<div class="code">
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> := "a".<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.f"><span class="id" title="abbreviation">f</span></a> := "f".<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.g"><span class="id" title="abbreviation">g</span></a> := "g".<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.l"><span class="id" title="abbreviation">l</span></a> := "l".<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a> := (<a class="idref" href="Records.html#STLCExtendedRecords.Base"><span class="id" title="constructor">Base</span></a> "A").<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a> := (<a class="idref" href="Records.html#STLCExtendedRecords.Base"><span class="id" title="constructor">Base</span></a> "B").<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.k"><span class="id" title="abbreviation">k</span></a> := "k".<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a> := "i<sub>1</sub>".<br/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.i2"><span class="id" title="abbreviation">i<sub>2</sub></span></a> := "i<sub>2</sub>".<br/>
</div>

<div class="doc">
<span class="inlinecode">{</span> <span class="inlinecode"><span class="id" title="var">i<sub>1</sub></span>:<span class="id" title="var">A</span></span> <span class="inlinecode">}</span> 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;Check&nbsp;(RCons&nbsp;i<sub>1</sub>&nbsp;A&nbsp;RNil).&nbsp;*)</span><br/>
</div>

<div class="doc">
<span class="inlinecode">{</span> <span class="inlinecode"><span class="id" title="var">i<sub>1</sub></span>:<span class="id" title="var">A</span>→<span class="id" title="var">B</span>,</span> <span class="inlinecode"><span class="id" title="var">i<sub>2</sub></span>:<span class="id" title="var">A</span></span> <span class="inlinecode">}</span> 
</div>
<div class="code">

<br/>
<span class="comment">(*&nbsp;Check&nbsp;(RCons&nbsp;i<sub>1</sub>&nbsp;(Arrow&nbsp;A&nbsp;B)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(RCons&nbsp;i<sub>2</sub>&nbsp;A&nbsp;RNil)).&nbsp;*)</span><br/>
</div>

<div class="doc">
<a name="lab351"></a><h3 class="section">良构性</h3>

<div class="paragraph"> </div>

 在将记录体的抽象语法从列表推广为用 nil/cons 表示时会引入一个问题：
    我们可能写出如下这种奇怪的类型…… 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Definition</span> <a name="STLCExtendedRecords.weird_type"><span class="id" title="definition">weird_type</span></a> := <a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <span class="id" title="definition">X</span> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a>.<br/>
</div>

<div class="doc">
该记录类型的「尾部（tail）」并不是一个真正的记录类型！ 
<div class="paragraph"> </div>

 我们要重构我们的类型断言，让 <span class="inlinecode"><span class="id" title="var">weird_type</span></span> 这种病态的（ill-formed）类型不能被赋项。
    为此，我们定义了断言 <span class="inlinecode"><span class="id" title="var">record_ty</span></span> 和 <span class="inlinecode"><span class="id" title="var">record_tm</span></span> 来刻画了记录体的类型和项，
    以及 <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> 用于排除劣构的类型。 
<div class="paragraph"> </div>

 首先，如果某个类型在最外层只用 <span class="inlinecode"><span class="id" title="var">RNil</span></span> 和 <span class="inlinecode"><span class="id" title="var">RCons</span></span> 构造，那么它是一个记录。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.record_ty"><span class="id" title="inductive">record_ty</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.RTnil"><span class="id" title="constructor">RTnil</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_ty"><span class="id" title="inductive">record_ty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.RTcons"><span class="id" title="constructor">RTcons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_ty"><span class="id" title="inductive">record_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a>).<br/>
</div>

<div class="doc">
据此，我们可以定义良构的（well-formed）类型。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfBase"><span class="id" title="constructor">wfBase</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.Base"><span class="id" title="constructor">Base</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfArrow"><span class="id" title="constructor">wfArrow</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfRNil"><span class="id" title="constructor">wfRNil</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.wfRCons"><span class="id" title="constructor">wfRCons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_ty"><span class="id" title="inductive">record_ty</span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Records.html#record_ty"><span class="id" title="inductive">record_ty</span></a> <a class="idref" href="Records.html#well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a>.<br/>
</div>

<div class="doc">
需注意 <span class="inlinecode"><span class="id" title="var">record_ty</span></span> 不是递归的：它只检查最外层的构造子。另一方面，
    <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> 这一性质就其“每个记录体的尾部（即 <span class="inlinecode"><span class="id" title="var">RCons</span></span> 的第二个参数）
    都是记录体”的意义而言，保证了整个类型是良构的。

<div class="paragraph"> </div>

    当然，除了类型以外，我们还要考虑劣构的项。不过类型检查无需一个额外的
    <span class="inlinecode"><span class="id" title="var">well_formed_tm</span></span> 定义就能排除它们，因为项的结构是经过了检查的。
    我们需要的只是类似 <span class="inlinecode"><span class="id" title="var">record_ty</span></span> 的定义，即如果某个项以 <span class="inlinecode"><span class="id" title="var">trnil</span></span> 和 <span class="inlinecode"><span class="id" title="var">rcons</span></span>
    构造，那么它就是记录项。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.record_tm"><span class="id" title="inductive">record_tm</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rtnil"><span class="id" title="constructor">rtnil</span></a> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_tm"><span class="id" title="inductive">record_tm</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.rtcons"><span class="id" title="constructor">rtcons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#record_tm"><span class="id" title="inductive">record_tm</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Records.html#record_tm"><span class="id" title="inductive">record_tm</span></a>.<br/>
</div>

<div class="doc">
<a name="lab352"></a><h3 class="section">代换</h3>

<div class="paragraph"> </div>

 代换很容易扩展。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="STLCExtendedRecords.subst"><span class="id" title="definition">subst</span></a> (<span class="id" title="var">x</span>:<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<span class="id" title="var">s</span>:<a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a>) (<span class="id" title="var">t</span>:<a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a>) : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <span class="id" title="var">y</span> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="definition">eqb_string</span> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <span class="id" title="var">y</span> <span class="id" title="var">T</span> <span class="id" title="var">t<sub>1</sub></span> ⇒ <a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <span class="id" title="var">y</span> <span class="id" title="var">T</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="definition">eqb_string</span> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <span class="id" title="var">y</span> <span class="id" title="keyword">then</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="keyword">else</span> (<a class="idref" href="Records.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="var">t<sub>1</sub></span>))<br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> ⇒ <a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> (<a class="idref" href="Records.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="var">t<sub>1</sub></span>) (<a class="idref" href="Records.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="var">t<sub>2</sub></span>)<br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">i</span> ⇒ <a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> (<a class="idref" href="Records.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="var">t<sub>1</sub></span>) <span class="id" title="var">i</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a> ⇒ <a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <span class="id" title="var">i</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">tr<sub>1</sub></span> ⇒ <a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <span class="id" title="var">i</span> (<a class="idref" href="Records.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="var">t<sub>1</sub></span>) (<a class="idref" href="Records.html#subst"><span class="id" title="definition">subst</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#s"><span class="id" title="variable">s</span></a> <span class="id" title="var">tr<sub>1</sub></span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a name="f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">&quot;</span></a>'[' x ':=' s ']' t" := (<a class="idref" href="Records.html#STLCExtendedRecords.subst"><span class="id" title="definition">subst</span></a> <span class="id" title="var">x</span> <span class="id" title="var">s</span> <span class="id" title="var">t</span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 20).<br/>
</div>

<div class="doc">
<a name="lab353"></a><h3 class="section">归约</h3>

<div class="paragraph"> </div>

 如果一个记录体的所有字段都是值，那么它本身也是值。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.v_abs"><span class="id" title="constructor">v_abs</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">T<sub>11</sub></span> <span class="id" title="var">t<sub>12</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" title="inductive">value</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a> <a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.v_rnil"><span class="id" title="constructor">v_rnil</span></a> : <a class="idref" href="Records.html#value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.v_rcons"><span class="id" title="constructor">v_rcons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">vr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#vr"><span class="id" title="variable">vr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#value"><span class="id" title="inductive">value</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Records.html#vr"><span class="id" title="variable">vr</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Records.html#value"><span class="id" title="inductive">value</span></a>.<br/>
</div>

<div class="doc">
为了定义归约，我们需要一个辅助函数来提取记录项中的某个字段： 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="STLCExtendedRecords.tlookup"><span class="id" title="definition">tlookup</span></a> (<span class="id" title="var">i</span>:<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<span class="id" title="var">tr</span>:<a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <span class="id" title="var">i'</span> <span class="id" title="var">t</span> <span class="id" title="var">tr'</span> ⇒ <span class="id" title="keyword">if</span> <span class="id" title="definition">eqb_string</span> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">i'</span> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">t</span> <span class="id" title="keyword">else</span> <a class="idref" href="Records.html#tlookup"><span class="id" title="definition">tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">tr'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">step</span></span> 函数会在投影规则中使用该项一级的查找函数。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Reserved Notation</span> &quot;t<sub>1</sub> '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>' t<sub>2</sub>" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.step"><span class="id" title="inductive">step</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_AppAbs"><span class="id" title="constructor">ST_AppAbs</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">T<sub>11</sub></span> <span class="id" title="var">t<sub>12</sub></span> <span class="id" title="var">v<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a> <a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a>) <a class="idref" href="Records.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">[</span></a><a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">:=</span></a><a class="idref" href="Records.html#v<sub>2</sub>"><span class="id" title="variable">v<sub>2</sub></span></a><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">]</span></a><a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_App1"><span class="id" title="constructor">ST_App1</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#t<sub>1</sub>'"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#t<sub>1</sub>'"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_App2"><span class="id" title="constructor">ST_App2</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span> <span class="id" title="var">t<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#t<sub>2</sub>'"><span class="id" title="variable">t<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>'"><span class="id" title="variable">t<sub>2</sub>'</span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_Proj1"><span class="id" title="constructor">ST_Proj1</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#t<sub>1</sub>'"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <a class="idref" href="Records.html#t<sub>1</sub>'"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_ProjRcd"><span class="id" title="constructor">ST_ProjRcd</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">tr</span> <span class="id" title="var">i</span> <span class="id" title="var">vi</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.tlookup"><span class="id" title="definition">tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#vi"><span class="id" title="variable">vi</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#vi"><span class="id" title="variable">vi</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_Rcd_Head"><span class="id" title="constructor">ST_Rcd_Head</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">tr<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#t<sub>1</sub>'"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#tr<sub>2</sub>"><span class="id" title="variable">tr<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#t<sub>1</sub>'"><span class="id" title="variable">t<sub>1</sub>'</span></a> <a class="idref" href="Records.html#tr<sub>2</sub>"><span class="id" title="variable">tr<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.ST_Rcd_Tail"><span class="id" title="constructor">ST_Rcd_Tail</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">v<sub>1</sub></span> <span class="id" title="var">tr<sub>2</sub></span> <span class="id" title="var">tr<sub>2</sub>'</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#tr<sub>2</sub>"><span class="id" title="variable">tr<sub>2</sub></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#tr<sub>2</sub>'"><span class="id" title="variable">tr<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Records.html#tr<sub>2</sub>"><span class="id" title="variable">tr<sub>2</sub></span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#v<sub>1</sub>"><span class="id" title="variable">v<sub>1</sub></span></a> <a class="idref" href="Records.html#tr<sub>2</sub>'"><span class="id" title="variable">tr<sub>2</sub>'</span></a><a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">)</span></a><br/>
<br/>
<span class="id" title="keyword">where</span> <a name="b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>' t<sub>2</sub>" := (<a class="idref" href="Records.html#step"><span class="id" title="inductive">step</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> <a name="STLCExtendedRecords.multistep"><span class="id" title="abbreviation">multistep</span></a> := (<a class="idref" href="Smallstep.html#multi"><span class="id" title="inductive">multi</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.step"><span class="id" title="inductive">step</span></a>).<br/>
<span class="id" title="keyword">Notation</span> <a name="ff4825881b53f5a844c4a6849ad963f<sub>9</sub>"><span class="id" title="notation">&quot;</span></a>t<sub>1</sub> '<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span><span style='letter-spacing:-.2em;'>&gt;</span><span style='vertical-align:15%;'>*</span></span></span>' t<sub>2</sub>" := (<a class="idref" href="Records.html#STLCExtendedRecords.multistep"><span class="id" title="abbreviation">multistep</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>) (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Records.html#step"><span class="id" title="inductive">step</span></a>.<br/>
</div>

<div class="doc">
<a name="lab354"></a><h3 class="section">定型</h3>

<div class="paragraph"> </div>

 接着我们定义定型规则。这些规则基本上直接转写自前面的推理规则，
    唯一明显的区别是对 <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> 的使用。在非形式化的表述中，
    我们使用了只允许良构记录类型的语法，因此我们无需添加单独的检查。

<div class="paragraph"> </div>

    我们需要维持一个合理的条件，就是只要 <span class="inlinecode"><span class="id" title="var">has_type</span></span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> 成立，那么
    <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> 也应当成立，这样 <span class="inlinecode"><span class="id" title="var">has_type</span></span> 就不会将劣构的类型赋予项了。
    我们后面会证明此定理。然而，我们并不想将 <span class="inlinecode"><span class="id" title="var">has_type</span></span> 的定义和不必要的
    <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> 混在一起，而是只在需要的地方使用 <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> 检查：
    即在归纳调用 <span class="inlinecode"><span class="id" title="var">has_type</span></span> 时不会检查类型良构性的地方使用它。例如，我们会在
    <span class="inlinecode"><span class="id" title="var">T_Var</span></span> 的情况下检查 <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span>，因为这里没有归纳的 <span class="inlinecode"><span class="id" title="var">has_type</span></span>
    调用来执行此操作。同样，在 <span class="inlinecode"><span class="id" title="var">T_Abs</span></span> 的情况下，我们需要一个 <span class="inlinecode"><span class="id" title="var">well_formed_ty</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span>
    的证明，因为对 <span class="inlinecode"><span class="id" title="var">has_type</span></span> 的归纳调用只能保证 <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span> 是良构的。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Fixpoint</span> <a name="STLCExtendedRecords.Tlookup"><span class="id" title="definition">Tlookup</span></a> (<span class="id" title="var">i</span>:<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>) (<span class="id" title="var">Tr</span>:<a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#option"><span class="id" title="inductive">option</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <a class="idref" href="Records.html#Tr"><span class="id" title="variable">Tr</span></a> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <span class="id" title="var">i'</span> <span class="id" title="var">T</span> <span class="id" title="var">Tr'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="definition">eqb_string</span> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">i'</span> <span class="id" title="keyword">then</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <span class="id" title="var">T</span> <span class="id" title="keyword">else</span> <a class="idref" href="Records.html#Tlookup"><span class="id" title="definition">Tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <span class="id" title="var">Tr'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#None"><span class="id" title="constructor">None</span></a><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a name="STLCExtendedRecords.context"><span class="id" title="definition">context</span></a> := <span class="id" title="definition">partial_map</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Reserved Notation</span> &quot;Gamma '&#x22A2;' t '&#x2208;' T" (<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.has_type"><span class="id" title="inductive">has_type</span></a> : <a class="idref" href="Records.html#STLCExtendedRecords.context"><span class="id" title="definition">context</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_Var"><span class="id" title="constructor">T_Var</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">x</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_Abs"><span class="id" title="constructor">T_Abs</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">x</span> <span class="id" title="var">T<sub>11</sub></span> <span class="id" title="var">T<sub>12</sub></span> <span class="id" title="var">t<sub>12</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><span class="id" title="definition">update</span> <a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T<sub>12</sub>"><span class="id" title="variable">T<sub>12</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a> <a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a> <a class="idref" href="Records.html#T<sub>12</sub>"><span class="id" title="variable">T<sub>12</sub></span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_App"><span class="id" title="constructor">T_App</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">T<sub>1</sub></span> <span class="id" title="var">T<sub>2</sub></span> <span class="id" title="var">Gamma</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T<sub>1</sub>"><span class="id" title="variable">T<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T<sub>2</sub>"><span class="id" title="variable">T<sub>2</sub></span></a><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;records:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_Proj"><span class="id" title="constructor">T_Proj</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span> <span class="id" title="var">Ti</span> <span class="id" title="var">Tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#Tr"><span class="id" title="variable">Tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.Tlookup"><span class="id" title="definition">Tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#Tr"><span class="id" title="variable">Tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#Ti"><span class="id" title="variable">Ti</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#Ti"><span class="id" title="variable">Ti</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_RNil"><span class="id" title="constructor">T_RNil</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a><br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.T_RCons"><span class="id" title="constructor">T_RCons</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">tr</span> <span class="id" title="var">Tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#Tr"><span class="id" title="variable">Tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_ty"><span class="id" title="inductive">record_ty</span></a> <a class="idref" href="Records.html#Tr"><span class="id" title="variable">Tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_tm"><span class="id" title="inductive">record_tm</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="Records.html#Tr"><span class="id" title="variable">Tr</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a><br/>
<br/>
<span class="id" title="keyword">where</span> <a name="81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&quot;</span></a>Gamma '&#x22A2;' t '&#x2208;' T" := (<a class="idref" href="Records.html#has_type"><span class="id" title="inductive">has_type</span></a> <span class="id" title="var">Gamma</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Records.html#has_type"><span class="id" title="inductive">has_type</span></a>.<br/>
</div>

<div class="doc">
<a name="lab355"></a><h2 class="section">示例</h2>

<div class="paragraph"> </div>

<a name="lab356"></a><h4 class="section">练习：2 星, standard (examples)</h4>
 完成下面的证明。在此证明中可随意使用 Coq 的自动化特性。然而，
    如果你不熟悉类型系统是如何工作的，那么应该先用基本策略来完成证明
    （比如使用 <span class="inlinecode"><span class="id" title="tactic">apply</span></span> 而非 <span class="inlinecode"><span class="id" title="tactic">eapply</span></span>），再试着用自动化特性来简化它。
    在证明之前，请先确保你理解它的意思。 
</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.typing_example_2"><span class="id" title="lemma">typing_example_2</span></a> :<br/>
&nbsp;&nbsp;<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" title="abbreviation">i<sub>2</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a>) <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" title="abbreviation">i<sub>2</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" title="abbreviation">i<sub>2</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a>))<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a name="STLCExtendedRecords.typing_nonexample"><span class="id" title="definition">typing_nonexample</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#611abc97cba304de784fa909dbdea1fa"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">∃</span></a> <span class="id" title="var">T</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><span class="id" title="definition">update</span> <span class="id" title="definition">empty</span> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" title="abbreviation">i<sub>2</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.Arrow"><span class="id" title="constructor">Arrow</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a>)<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.B"><span class="id" title="abbreviation">B</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a>)) (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a>)<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a name="STLCExtendedRecords.typing_nonexample_2"><span class="id" title="definition">typing_nonexample_2</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">y</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#611abc97cba304de784fa909dbdea1fa"><span class="id" title="notation">¬</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">∃</span></a> <span class="id" title="var">T</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">,</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><span class="id" title="definition">update</span> <span class="id" title="definition">empty</span> <a class="idref" href="Records.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.RCons"><span class="id" title="constructor">RCons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a> <a class="idref" href="Records.html#STLCExtendedRecords.A"><span class="id" title="abbreviation">A</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.RNil"><span class="id" title="constructor">RNil</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.a"><span class="id" title="abbreviation">a</span></a>) <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i1"><span class="id" title="abbreviation">i<sub>1</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#y"><span class="id" title="variable">y</span></a>) (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.i2"><span class="id" title="abbreviation">i<sub>2</sub></span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#y"><span class="id" title="variable">y</span></a>) <a class="idref" href="Records.html#STLCExtendedRecords.trnil"><span class="id" title="constructor">trnil</span></a>))<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;请在此处解答&nbsp;*)</span> <span class="id" title="var">Admitted</span>.<br/>
</div>

<div class="doc">
<a name="lab357"></a><h2 class="section">定型的性质</h2>

<div class="paragraph"> </div>

 对该系统可进性和保型性的证明与对纯粹的简单类型 λ-演算的基本相同，
    不过我们需要引入一些涉及记录体的引理来作的技术上处理。 
</div>

<div class="doc">
<a name="lab358"></a><h3 class="section">良构性</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.wf_rcd_lookup"><span class="id" title="lemma">wf_rcd_lookup</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">i</span> <span class="id" title="var">T</span> <span class="id" title="var">Ti</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.Tlookup"><span class="id" title="definition">Tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#Ti"><span class="id" title="variable">Ti</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#Ti"><span class="id" title="variable">Ti</span></a>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">i</span> <span class="id" title="var">T</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">T</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">solve_by_invert</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;RCons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Records.html#STLCExtendedRecords.Tlookup"><span class="id" title="definition">Tlookup</span></a> <span class="id" title="tactic">in</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">eqb_string</span> <span class="id" title="var">i</span> <span class="id" title="var">s</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>. <span class="id" title="tactic">subst</span>... <span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.step_preserves_record_tm"><span class="id" title="lemma">step_preserves_record_tm</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">tr</span> <span class="id" title="var">tr'</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_tm"><span class="id" title="inductive">record_tm</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#tr'"><span class="id" title="variable">tr'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.record_tm"><span class="id" title="inductive">record_tm</span></a> <a class="idref" href="Records.html#tr'"><span class="id" title="variable">tr'</span></a>.<br/>
<div class="togglescript" id="proofcontrol2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')"><span class="show"></span></div>
<div class="proofscript" id="proof2" onclick="toggleDisplay('proof2');toggleDisplay('proofcontrol2')">
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tr</span> <span class="id" title="var">tr'</span> <span class="id" title="var">Hrt</span> <span class="id" title="var">Hstp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hrt</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hstp</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.has_type__wf"><span class="id" title="lemma">has_type__wf</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.well_formed_ty"><span class="id" title="inductive">well_formed_ty</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a>.<br/>
<div class="togglescript" id="proofcontrol3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')"><span class="show"></span></div>
<div class="proofscript" id="proof3" onclick="toggleDisplay('proof3');toggleDisplay('proofcontrol3')">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Htyp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Htyp</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_App&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">IHHtyp1</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Proj&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.wf_rcd_lookup"><span class="id" title="lemma">wf_rcd_lookup</span></a>...<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab359"></a><h3 class="section">依字段查表</h3>

<div class="paragraph"> </div>

 引理：若 <span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T</span></span> 和 <span class="inlinecode"><span class="id" title="var">Tlookup</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> 返回 <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">Ti</span></span>，
      则对于 <span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">ti</span></span> <span class="inlinecode">\<span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">Ti</span></span> 的项 <span class="inlinecode"><span class="id" title="var">ti</span></span>，<span class="inlinecode"><span class="id" title="var">tlookup</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">v</span></span> 会返回 <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">ti</span></span>。

<div class="paragraph"> </div>

    证明：对定型导出式 <span class="inlinecode"><span class="id" title="var">Htyp</span></span> 来归纳。由于 <span class="inlinecode"><span class="id" title="var">Tlookup</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">Ti</span></span>，因此
      <span class="inlinecode"><span class="id" title="var">T</span></span> 必为记录类型，据此以及 <span class="inlinecode"><span class="id" title="var">v</span></span> 为值的观察，可以消除了部分情况，
      剩下的只有 <span class="inlinecode"><span class="id" title="var">T_RCons</span></span> 的情况。

<div class="paragraph"> </div>

      定型导出式的最后一步是根据 <span class="inlinecode"><span class="id" title="var">T_RCons</span></span> 得来的，那么对于某些 <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span>、<span class="inlinecode"><span class="id" title="var">t</span></span>、<span class="inlinecode"><span class="id" title="var">tr</span></span>、<span class="inlinecode"><span class="id" title="var">T</span></span>
      和 <span class="inlinecode"><span class="id" title="var">Tr</span></span> 来说，<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span> 且 <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">RCons</span></span> <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">Tr</span></span>。

<div class="paragraph"> </div>

      现在还剩下两种情况需要考虑，即 <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">i</span></span> 是否成立。

<div class="paragraph"> </div>

<ul class="doclist">
<li> 若 <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span>，那么根据 <span class="inlinecode"><span class="id" title="var">Tlookup</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">(<span class="id" title="var">RCons</span></span> <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode"><span class="id" title="var">Tr</span>)</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">Ti</span></span>，我们有
        <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Ti</span></span>。它根据 <span class="inlinecode"><span class="id" title="var">t</span></span> 本身满足此定理得出。

<div class="paragraph"> </div>


</li>
<li> 另一方面，假设 <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">i<sub>0</sub></span></span>。那么
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Tlookup</span> <span class="id" title="var">i</span> <span class="id" title="var">T</span> = <span class="id" title="var">Tlookup</span> <span class="id" title="var">i</span> <span class="id" title="var">Tr</span>
<div class="paragraph"> </div>

</span>        且
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tlookup</span> <span class="id" title="var">i</span> <span class="id" title="var">t</span> = <span class="id" title="var">tlookup</span> <span class="id" title="var">i</span> <span class="id" title="var">tr</span>,
<div class="paragraph"> </div>

</span>        则结果由归纳假设得出。 <font size=-2>&#9744;</font>

</li>
</ul>

<div class="paragraph"> </div>

    以下为形式化证明：

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.lookup_field_in_value"><span class="id" title="lemma">lookup_field_in_value</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">v</span> <span class="id" title="var">T</span> <span class="id" title="var">i</span> <span class="id" title="var">Ti</span>,<br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.Tlookup"><span class="id" title="definition">Tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#Ti"><span class="id" title="variable">Ti</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">∃</span></a> <span class="id" title="var">ti</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tlookup"><span class="id" title="definition">tlookup</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#ti"><span class="id" title="variable">ti</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d82a7d96d3659d805ffe732283716822"><span class="id" title="notation">∧</span></a> <span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#ti"><span class="id" title="variable">ti</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#Ti"><span class="id" title="variable">Ti</span></a>.<br/>
<div class="togglescript" id="proofcontrol4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')"><span class="show"></span></div>
<div class="proofscript" id="proof4" onclick="toggleDisplay('proof4');toggleDisplay('proofcontrol4')">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">v</span> <span class="id" title="var">T</span> <span class="id" title="var">i</span> <span class="id" title="var">Ti</span> <span class="id" title="var">Hval</span> <span class="id" title="var">Htyp</span> <span class="id" title="var">Hget</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (@<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a>) <span class="id" title="keyword">as</span> <span class="id" title="var">Gamma</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Htyp</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">solve_by_invert</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_RCons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hget</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="definition">eqb_string</span> <span class="id" title="var">i</span> <span class="id" title="var">i<sub>0</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;i&nbsp;is&nbsp;first&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hget</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">t</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;get&nbsp;tail&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHtyp2</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">vi</span> [<span class="id" title="var">Hgeti</span> <span class="id" title="var">Htypi</span>]]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">Hval</span>... <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab360"></a><h3 class="section">可进性</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <a name="STLCExtendedRecords.progress"><span class="id" title="lemma">progress</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.value"><span class="id" title="inductive">value</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#7a45dffb109c3069e5c675be68643e<sub>60</sub>"><span class="id" title="notation">∨</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">∃</span></a> <span class="id" title="var">t'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#t'"><span class="id" title="variable">t'</span></a>.<br/>
<div class="togglescript" id="proofcontrol5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')"><span class="show"></span></div>
<div class="proofscript" id="proof5" onclick="toggleDisplay('proof5');toggleDisplay('proofcontrol5')">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;定理：假设&nbsp;empty&nbsp;&#x22A2;&nbsp;t&nbsp;:&nbsp;T。那么以下二者之一成立：<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.&nbsp;t&nbsp;为值，或者<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.&nbsp;对某个&nbsp;t'，有&nbsp;t&nbsp;<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span>&nbsp;t'。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证明：对给定的定型导出式作归纳。&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Ht</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (@<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a>) <span class="id" title="keyword">as</span> <span class="id" title="var">Gamma</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">HeqGamma</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Ht</span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">HeqGamma</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Var&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;一给定的定型导出式的最后一条规则不能为&nbsp;<span class="inlinecode"><span class="id" title="var">T_Var</span></span>，因为它不应是<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T</span></span>&nbsp;的情况（因为上下文为空）。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若最后应用的规则为&nbsp;<span class="inlinecode"><span class="id" title="var">T_Abs</span></span>，则有&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>12</sub></span></span>，它是一个值。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_App&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若最后应用的规则为&nbsp;T_App，则有&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>。这点可由以下规则的形式得到：<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据归纳假设，t<sub>1</sub>&nbsp;和&nbsp;t<sub>2</sub>&nbsp;要么是值，要么可再推进一步。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHt1</span>; <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;t<sub>1</sub>&nbsp;为值&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHt2</span>; <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;t<sub>2</sub>&nbsp;为值&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>&nbsp;均为值，那么我们知道<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>12</sub></span></span>，因为“抽象”是唯一具有箭头类型的值。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;然而根据&nbsp;<span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span>，<span class="inlinecode">(<span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>12</sub></span>)</span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">t<sub>2</sub></span>]<span class="id" title="var">t<sub>12</sub></span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">solve_by_invert</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">[</span></a><span class="id" title="var">x</span><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">:=</span></a><span class="id" title="var">t<sub>2</sub></span><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">]</span></a><span class="id" title="var">t<sub>12</sub></span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;t<sub>2</sub>&nbsp;推进一步&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span>&nbsp;为值且&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub>'</span></span>，那么根据&nbsp;<span class="inlinecode"><span class="id" title="var">ST_App2</span></span>，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub>'</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t<sub>2</sub>'</span> <span class="id" title="var">Hstp</span>]. <span class="id" title="tactic">∃</span> (<a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub>'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;t<sub>1</sub>&nbsp;推进一步&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;最后，若&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub>'</span></span>，那么根据&nbsp;<span class="inlinecode"><span class="id" title="var">ST_App1</span></span>，<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub>'</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">Hstp</span>]. <span class="id" title="tactic">∃</span> (<a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <span class="id" title="var">t<sub>1</sub>'</span> <span class="id" title="var">t<sub>2</sub></span>)...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Proj&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若给定导出式的最后一条规则为&nbsp;<span class="inlinecode"><span class="id" title="var">T_Proj</span></span>，那么<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">rproj</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>&nbsp;且&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode">(<span class="id" title="var">TRcd</span></span> <span class="inlinecode"><span class="id" title="var">Tr</span>)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据归纳假设，<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;要么是值，要么可以推进一步。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHt</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;rcd&nbsp;为值&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;为值，那么我们可使用引理&nbsp;<span class="inlinecode"><span class="id" title="var">lookup_field_in_value</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;来证明对某个&nbsp;<span class="inlinecode"><span class="id" title="var">ti</span></span>&nbsp;而言&nbsp;<span class="inlinecode"><span class="id" title="var">tlookup</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">ti</span></span>。根据<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">ST_ProjRcd</span></span>&nbsp;可得&nbsp;<span class="inlinecode"><span class="id" title="var">rproj</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">ti</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Records.html#STLCExtendedRecords.lookup_field_in_value"><span class="id" title="lemma">lookup_field_in_value</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="var">Ht</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">ti</span> [<span class="id" title="var">Hlkup</span> <span class="id" title="var">_</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">ti</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;rcd&nbsp;推进一步&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;另一方面，若&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>，那么根据&nbsp;<span class="inlinecode"><span class="id" title="var">ST_Proj1</span></span>&nbsp;可得<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">rproj</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">rproj</span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>0</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">Hstp</span>]. <span class="id" title="tactic">∃</span> (<a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <span class="id" title="var">t'</span> <span class="id" title="var">i</span>)...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_RNil&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若给定导出式中的最后一条规则为&nbsp;<span class="inlinecode"><span class="id" title="var">T_RNil</span></span>，那么&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">trnil</span></span>，为值。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_RCons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若最后一条规则为&nbsp;<span class="inlinecode"><span class="id" title="var">T_RCons</span></span>，那么&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span>&nbsp;且<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">Tr</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据归纳法则，<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span>&nbsp;要么是值，要么可再推进一步。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHt1</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;head&nbsp;为值&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHt2</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;tail&nbsp;为值&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span>&nbsp;均为值，那么&nbsp;<span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span>&nbsp;也为值。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">left</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;× <span class="comment">(*&nbsp;tail&nbsp;推进一步&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;为值且&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">tr'</span></span>，那么根据&nbsp;<span class="inlinecode"><span class="id" title="var">ST_Rcd_Tail</span></span>，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr'</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">tr'</span> <span class="id" title="var">Hstp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <span class="id" title="var">i</span> <span class="id" title="var">t</span> <span class="id" title="var">tr'</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;head&nbsp;推进一步&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>，那么根据&nbsp;<span class="inlinecode"><span class="id" title="var">ST_Rcd_Head</span></span>，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">right</span>. <span class="id" title="tactic">destruct</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">as</span> [<span class="id" title="var">t'</span> <span class="id" title="var">Hstp</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <span class="id" title="var">i</span> <span class="id" title="var">t'</span> <span class="id" title="var">tr</span>)... <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab361"></a><h3 class="section">上下文不变性</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Inductive</span> <a name="STLCExtendedRecords.appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#STLCExtendedRecords.tm"><span class="id" title="inductive">tm</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_var"><span class="id" title="constructor">afi_var</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.var"><span class="id" title="constructor">var</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_app1"><span class="id" title="constructor">afi_app1</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_app2"><span class="id" title="constructor">afi_app2</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">t<sub>1</sub></span> <span class="id" title="var">t<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.app"><span class="id" title="constructor">app</span></a> <a class="idref" href="Records.html#t<sub>1</sub>"><span class="id" title="variable">t<sub>1</sub></span></a> <a class="idref" href="Records.html#t<sub>2</sub>"><span class="id" title="variable">t<sub>2</sub></span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_abs"><span class="id" title="constructor">afi_abs</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">T<sub>11</sub></span> <span class="id" title="var">t<sub>12</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#32263a1c8b01baecdff9deb038955bc<sub>9</sub>"><span class="id" title="notation">≠</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.abs"><span class="id" title="constructor">abs</span></a> <a class="idref" href="Records.html#y"><span class="id" title="variable">y</span></a> <a class="idref" href="Records.html#T<sub>11</sub>"><span class="id" title="variable">T<sub>11</sub></span></a> <a class="idref" href="Records.html#t<sub>12</sub>"><span class="id" title="variable">t<sub>12</sub></span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_proj"><span class="id" title="constructor">afi_proj</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span> <span class="id" title="var">i</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.rproj"><span class="id" title="constructor">rproj</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_rhead"><span class="id" title="constructor">afi_rhead</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">i</span> <span class="id" title="var">ti</span> <span class="id" title="var">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#ti"><span class="id" title="variable">ti</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#ti"><span class="id" title="variable">ti</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a>)<br/>
&nbsp;&nbsp;| <a name="STLCExtendedRecords.afi_rtail"><span class="id" title="constructor">afi_rtail</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">i</span> <span class="id" title="var">ti</span> <span class="id" title="var">tr</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> (<a class="idref" href="Records.html#STLCExtendedRecords.rcons"><span class="id" title="constructor">rcons</span></a> <a class="idref" href="Records.html#i"><span class="id" title="variable">i</span></a> <a class="idref" href="Records.html#ti"><span class="id" title="variable">ti</span></a> <a class="idref" href="Records.html#tr"><span class="id" title="variable">tr</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Constructors</span> <a class="idref" href="Records.html#appears_free_in"><span class="id" title="inductive">appears_free_in</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.context_invariance"><span class="id" title="lemma">context_invariance</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">Gamma'</span> <span class="id" title="var">t</span> <span class="id" title="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#S"><span class="id" title="variable">S</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, <a class="idref" href="Records.html#STLCExtendedRecords.appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a> <a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="Records.html#Gamma'"><span class="id" title="variable">Gamma'</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">)</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma'"><span class="id" title="variable">Gamma'</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#S"><span class="id" title="variable">S</span></a>.<br/>
<div class="togglescript" id="proofcontrol6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')"><span class="show"></span></div>
<div class="proofscript" id="proof6" onclick="toggleDisplay('proof6');toggleDisplay('proofcontrol6')">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">Gamma'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Gamma'</span> <span class="id" title="var">Heqv</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Var&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Var"><span class="id" title="constructor">T_Var</span></a>... <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">Heqv</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Abs"><span class="id" title="constructor">T_Abs</span></a>... <span class="id" title="tactic">apply</span> <span class="id" title="var">IHhas_type</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">y</span> <span class="id" title="var">Hafi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">update</span>, <span class="id" title="definition">t_update</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="axiom">eqb_stringP</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_App&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_App"><span class="id" title="constructor">T_App</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">T<sub>1</sub></span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_RCons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_RCons"><span class="id" title="constructor">T_RCons</span></a>... <span class="id" title="keyword">Qed</span>.<br/>
</div>

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.free_in_context"><span class="id" title="lemma">free_in_context</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Gamma</span>,<br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#STLCExtendedRecords.appears_free_in"><span class="id" title="inductive">appears_free_in</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">∃</span></a> <span class="id" title="var">T'</span><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#84eb6d2849dbf3581b1c0c05add5f2d<sub>8</sub>"><span class="id" title="notation">,</span></a> <a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#1c39bf18749e5cc609e83c0a0ba5a372"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#Some"><span class="id" title="constructor">Some</span></a> <a class="idref" href="Records.html#T'"><span class="id" title="variable">T'</span></a>.<br/>
<div class="togglescript" id="proofcontrol7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')"><span class="show"></span></div>
<div class="proofscript" id="proof7" onclick="toggleDisplay('proof7');toggleDisplay('proofcontrol7')">
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span> <span class="id" title="var">T</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">Hafi</span> <span class="id" title="var">Htyp</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">Htyp</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hafi</span>; <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">IHHtyp</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">T'</span> <span class="id" title="var">Hctx</span>]... <span class="id" title="tactic">∃</span> <span class="id" title="var">T'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">update</span>, <span class="id" title="definition">t_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hctx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">false_eqb_string</span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hctx</span>...<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a name="lab362"></a><h3 class="section">保型性</h3>

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Lemma</span> <a name="STLCExtendedRecords.substitution_preserves_typing"><span class="id" title="lemma">substitution_preserves_typing</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">x</span> <span class="id" title="var">U</span> <span class="id" title="var">v</span> <span class="id" title="var">t</span> <span class="id" title="var">S</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><span class="id" title="definition">update</span> <a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a> <a class="idref" href="Records.html#U"><span class="id" title="variable">U</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#S"><span class="id" title="variable">S</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#v"><span class="id" title="variable">v</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#U"><span class="id" title="variable">U</span></a>   <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#Gamma"><span class="id" title="variable">Gamma</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">[</span></a><a class="idref" href="Records.html#x"><span class="id" title="variable">x</span></a><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">:=</span></a><a class="idref" href="Records.html#v"><span class="id" title="variable">v</span></a><a class="idref" href="Records.html#f129d782ce90312e1d018ee6cea605be"><span class="id" title="notation">]</span></a><a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#S"><span class="id" title="variable">S</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;定理：若&nbsp;x<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span>U;Gamma&nbsp;&#x22A2;&nbsp;t&nbsp;:&nbsp;S&nbsp;且&nbsp;empty&nbsp;&#x22A2;&nbsp;v&nbsp;:&nbsp;U，则<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Gamma&nbsp;&#x22A2;&nbsp;(<span class="inlinecode"><span class="id" title="var">x</span>:=<span class="id" title="var">v</span></span>t)&nbsp;S。&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">x</span> <span class="id" title="var">U</span> <span class="id" title="var">v</span> <span class="id" title="var">t</span> <span class="id" title="var">S</span> <span class="id" title="var">Htypt</span> <span class="id" title="var">Htypv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">Gamma</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">S</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;证明：通过对项&nbsp;t&nbsp;作归纳可得。大部分情况下，结论可以从归纳假设直接得到，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;只有&nbsp;var、abs&nbsp;和&nbsp;rcons&nbsp;的情况需要额外证明。无法自动得到前两者，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;是因为我们必须处理变量之间的相互作用。对于&nbsp;rcons&nbsp;的情况，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们必须额外证明在项中作代换不改变它是否为一个记录项。&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">t</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">S</span> <span class="id" title="var">Gamma</span> <span class="id" title="var">Htypt</span>; <span class="id" title="tactic">simpl</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">Htypt</span>; <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;var&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">s</span> <span class="id" title="var">into</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;t&nbsp;=&nbsp;y，我们知道<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">U</span></span>&nbsp;且<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">x</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">U</span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">S</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;经反演可得&nbsp;<span class="inlinecode"><span class="id" title="var">update</span></span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">U</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们需要证明&nbsp;<span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">S</span></span>。<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;有两种情况需要考虑：<span class="inlinecode"><span class="id" title="var">x</span>=<span class="id" title="var">y</span></span>&nbsp;或&nbsp;<span class="inlinecode"><span class="id" title="var">x</span>≠<span class="id" title="var">y</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="definition">update</span>, <span class="id" title="definition">t_update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="axiom">eqb_stringP</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span>|<span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x=y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">y</span></span>，那么我们知道&nbsp;<span class="inlinecode"><span class="id" title="var">U</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">S</span></span>，以及&nbsp;<span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v</span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因此我们必须证明若&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">U</span></span>&nbsp;则&nbsp;<span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">U</span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们已经证明了此定理更一般的版本，即上下文不变性！&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>0</sub></span>; <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">clear</span> <span class="id" title="var">H<sub>0</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.context_invariance"><span class="id" title="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hcontra</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Records.html#STLCExtendedRecords.free_in_context"><span class="id" title="lemma">free_in_context</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">S</span> <span class="id" title="definition">empty</span> <span class="id" title="var">Hcontra</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">T'</span> <span class="id" title="var">HT'</span>]...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HT'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&lt;&gt;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">y</span></span>，则&nbsp;<span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">S</span></span>&nbsp;且代换没有效果。我们可以根据<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">T_Var</span></span>&nbsp;证明&nbsp;<span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">S</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Var"><span class="id" title="constructor">T_Var</span></a>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;abs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rename</span> <span class="id" title="var">s</span> <span class="id" title="var">into</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">t</span> <span class="id" title="var">into</span> <span class="id" title="var">T<sub>11</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span>，那么我们知道<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">x</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">U</span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span>→<span class="id" title="var">T<sub>12</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">x</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">U</span>;</span> <span class="inlinecode"><span class="id" title="var">y</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">T<sub>11</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">v</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">U</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据归纳假设，我们知道对于所有的&nbsp;S&nbsp;Gamma，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">x</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">U</span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">S</span></span> <span class="inlinecode">→</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="var">S</span></span>.<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们可以计算出<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"></span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode">(<span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">eqb_string</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">t<sub>0</sub></span>)</span> <span class="inlinecode"></span>，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;此时我们必须证明&nbsp;<span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span>→<span class="id" title="var">T<sub>12</sub></span></span>。我们知道可以用<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">T_Abs</span></span>&nbsp;来证明它，因此接下来需要证明的就是：<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">y</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">T<sub>11</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="keyword">if</span></span> <span class="inlinecode"><span class="id" title="var">eqb_string</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">y</span></span> <span class="inlinecode"><span class="id" title="keyword">then</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode"><span class="id" title="keyword">else</span></span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们考虑两种情况：<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">y</span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">y</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_Abs"><span class="id" title="constructor">T_Abs</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="axiom">eqb_stringP</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">Hxy</span>|<span class="id" title="var">Hxy</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x=y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">y</span></span>，则代换没有作用。上下文不变性保证了<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">y</span>:<span class="id" title="var">U</span>,<span class="id" title="var">y</span>:<span class="id" title="var">T<sub>11</sub></span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">Gamma</span>,<span class="id" title="var">y</span>:<span class="id" title="var">T<sub>11</sub></span></span>&nbsp;等价。在前者的上下文中有&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span>&nbsp;，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;那么在后者中也是这样。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.context_invariance"><span class="id" title="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hafi</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="definition">update</span>, <span class="id" title="definition">t_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="definition">eqb_string</span> <span class="id" title="var">y</span> <span class="id" title="var">x</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;x&lt;&gt;y&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode">≠</span> <span class="inlinecode"><span class="id" title="var">y</span></span>，那么归纳假设和上下文不变性能让我们证明<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">x</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">U</span>;</span> <span class="inlinecode"><span class="id" title="var">y</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">T<sub>11</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">y</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">T<sub>11</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">x</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">U</span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">y</span><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>&#x22A2;</span><span style='font-size:90%;'>&gt;</span></span></span></span><span class="id" title="var">T<sub>11</sub></span>;</span> <span class="inlinecode"><span class="id" title="var">Gamma</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v</span>]<span class="id" title="var">t<sub>0</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>12</sub></span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHt</span>. <span class="id" title="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.context_invariance"><span class="id" title="lemma">context_invariance</span></a>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">z</span> <span class="id" title="var">Hafi</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="definition">update</span>, <span class="id" title="definition">t_update</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="axiom">eqb_stringP</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>)...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="lemma">false_eqb_string</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;rcons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_RCons"><span class="id" title="constructor">T_RCons</span></a>... <span class="id" title="tactic">inversion</span> <span class="id" title="var">H<sub>7</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">simpl</span>...<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a name="STLCExtendedRecords.preservation"><span class="id" title="lemma">preservation</span></a> : <span class="id" title="keyword">∀</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">T</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Records.html#t"><span class="id" title="variable">t</span></a> <a class="idref" href="Records.html#b23b16d131795325d318c1eaac872f<sub>02</sub>"><span class="id" title="notation"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Records.html#t'"><span class="id" title="variable">t'</span></a>  <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#d43e996736952df71ebeeae74d10a287"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">&#x22A2;</span></a> <a class="idref" href="Records.html#t'"><span class="id" title="variable">t'</span></a> <a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">\</span></a><a class="idref" href="Records.html#81696c1f94a107d8d6b1837b32776ca<sub>5</sub>"><span class="id" title="notation">in</span></a> <a class="idref" href="Records.html#T"><span class="id" title="variable">T</span></a>.<br/>
<span class="id" title="keyword">Proof</span> <span class="id" title="keyword">with</span> <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t</span> <span class="id" title="var">t'</span> <span class="id" title="var">T</span> <span class="id" title="var">HT</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;定理：若&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T</span></span>&nbsp;且&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>，则<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t'</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T</span></span>.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (@<span class="id" title="definition">empty</span> <a class="idref" href="Records.html#STLCExtendedRecords.ty"><span class="id" title="inductive">ty</span></a>) <span class="id" title="keyword">as</span> <span class="id" title="var">Gamma</span>. <span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">HeqGamma</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">t'</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;证明：对给定的定型导出式来归纳。很多情况是矛盾的（<span class="inlinecode"><span class="id" title="var">T_Var</span></span>、<span class="inlinecode"><span class="id" title="var">T_Abs</span></span>）<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;或可直接从归纳假设得出（<span class="inlinecode"><span class="id" title="var">T_RCons</span></span>），我们只需证明那些“有趣”的情况。&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">HT</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">t'</span> <span class="id" title="var">HeqGamma</span> <span class="id" title="var">HE</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">HE</span>; <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_App&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若使用的最后一条规则为&nbsp;<span class="inlinecode"><span class="id" title="var">T_App</span></span>，那么&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证明&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>&nbsp;可能用到的三条规则是&nbsp;<span class="inlinecode"><span class="id" title="var">ST_App1</span></span>、<span class="inlinecode"><span class="id" title="var">ST_App2</span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">ST_AppAbs</span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;在前两种情况下，结果可直接从归纳假设得出。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HE</span>; <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;ST_AppAbs&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;对于第三种情况，假设<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>12</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;且<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t<sub>2</sub></span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span>。我们必须证明&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode">[<span class="id" title="var">x</span>:=<span class="id" title="var">v<sub>2</sub></span>]<span class="id" title="var">t<sub>12</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;根据假设我们知道<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">abs</span></span> <span class="inlinecode"><span class="id" title="var">x</span></span> <span class="inlinecode"><span class="id" title="var">T<sub>11</sub></span></span> <span class="inlinecode"><span class="id" title="var">t<sub>12</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span>→<span class="id" title="var">T<sub>2</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;经反演可得<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">x</span>:<span class="id" title="var">T<sub>1</sub></span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t<sub>12</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>2</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们已经证明了&nbsp;substitution_preserves_typing，又根据假设，有<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">v<sub>2</sub></span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">T<sub>1</sub></span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;故此分支证明完毕。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.substitution_preserves_typing"><span class="id" title="lemma">substitution_preserves_typing</span></a> <span class="id" title="keyword">with</span> <span class="id" title="var">T<sub>1</sub></span>...<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">HT<sub>1</sub></span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_Proj&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若&nbsp;<span class="inlinecode"><span class="id" title="var">T_Proj</span></span>，则&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">rproj</span></span> <span class="inlinecode"><span class="id" title="var">t<sub>1</sub></span></span> <span class="inlinecode"><span class="id" title="var">i</span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;证明&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">t'</span></span>&nbsp;需要两条规则：<span class="inlinecode"><span class="id" title="var">T_Proj1</span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">T_ProjRcd</span></span>。<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">t'</span></span>&nbsp;的定型可从前面情况中的归纳假设得出，因此我们只需考虑<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">T_ProjRcd</span></span>&nbsp;&nbsp;即可。<br/>
<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这里我们知道&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;为记录体值。由于使用了规则&nbsp;<span class="inlinecode"><span class="id" title="var">T_Proj</span></span>，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们知道对于某些&nbsp;<span class="inlinecode"><span class="id" title="var">i</span></span>&nbsp;和&nbsp;<span class="inlinecode"><span class="id" title="var">Tr</span></span>&nbsp;有&nbsp;<span class="inlinecode"><span class="id" title="var">empty</span></span> <span class="inlinecode">&#x22A2;</span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">\<span class="id" title="tactic">in</span></span> <span class="inlinecode"><span class="id" title="var">Tr</span></span>&nbsp;且<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">Tlookup</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">Tr</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">Some</span></span> <span class="inlinecode"><span class="id" title="var">Ti</span></span>。接着可以应用引理&nbsp;<span class="inlinecode"><span class="id" title="var">lookup_field_in_value</span></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;来查找该投影步骤所得的记录元素。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="Records.html#STLCExtendedRecords.lookup_field_in_value"><span class="id" title="lemma">lookup_field_in_value</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">HT</span> <span class="id" title="var">H</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">as</span> [<span class="id" title="var">vi</span> [<span class="id" title="var">Hget</span> <span class="id" title="var">Htyp</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>4</sub></span> <span class="id" title="tactic">in</span> <span class="id" title="var">Hget</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">Hget</span>. <span class="id" title="tactic">subst</span>...<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;T_RCons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;若最后一条规则为&nbsp;<span class="inlinecode"><span class="id" title="var">T_RCons</span></span>，那么对于某些&nbsp;<span class="inlinecode"><span class="id" title="var">i</span></span>、<span class="inlinecode"><span class="id" title="var">t</span></span>&nbsp;和满足<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">record_tm</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span>&nbsp;的&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span>，有&nbsp;<span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" title="var">rcons</span></span> <span class="inlinecode"><span class="id" title="var">i</span></span> <span class="inlinecode"><span class="id" title="var">t</span></span> <span class="inlinecode"><span class="id" title="var">tr</span></span>。若该步骤为<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">ST_Rcd_Head</span></span>，则结果可由归纳假设直接得出。若该步骤为<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="inlinecode"><span class="id" title="var">ST_Rcd_Tail</span></span>，那么对于某些&nbsp;<span class="inlinecode"><span class="id" title="var">tr<sub>2</sub>'</span></span>&nbsp;有&nbsp;<span class="inlinecode"><span class="id" title="var">tr</span></span> <span class="inlinecode"><span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:6%;'><span style='letter-spacing:-.2em;'>-</span><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode"><span class="id" title="var">tr<sub>2</sub>'</span></span>，<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;我们还需要使用引理&nbsp;<span class="inlinecode"><span class="id" title="var">step_preserves_record_tm</span></span>&nbsp;来证明&nbsp;<span class="inlinecode"><span class="id" title="var">record_tm</span></span> <span class="inlinecode"><span class="id" title="var">tr<sub>2</sub>'</span></span>。&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Records.html#STLCExtendedRecords.T_RCons"><span class="id" title="constructor">T_RCons</span></a>... <span class="id" title="tactic">eapply</span> <a class="idref" href="Records.html#STLCExtendedRecords.step_preserves_record_tm"><span class="id" title="lemma">step_preserves_record_tm</span></a>...<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<font size=-2>&#9744;</font>
</div>

<div class="code">

<br/>
<span class="id" title="keyword">End</span> <a class="idref" href="Records.html#STLCExtendedRecords"><span class="id" title="module">STLCExtendedRecords</span></a>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*&nbsp;2020年1月20日&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>